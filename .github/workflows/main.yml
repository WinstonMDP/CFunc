name: master-push-action
on: push
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2.6.0
    - name: Install LLVM and Clang
      uses: KyleMayes/install-llvm-action@v1.6.0
      with:
        version: "14.0"
    - continue-on-error: true
      run: |
          clang-format --style=file -n --Werror *.cpp *.h > formattingReport.txt
          clang-format -n --Werror noSuchFile > noSuchFileExample.txt
          clang-format -n --Werror noSuchFile noSuchFile > doubleNoSuchFileExample.txt
    - run: |
        if [[ "$(cat formattingReport.txt)" -ne "$(cat noSuchFileExample.txt)" && "$(cat formattingReport.txt)" -ne "$(cat doubleNoSuchFileExample.txt)" ]]; then
          exit 1
        fi
    - name: Write AST to ast.txt
      run: clang++ -Xclang -ast-dump -fsyntax-only Main.cpp > ast.txt || true
    - run: wc -l ast.txt | awk '{print "Current complexity:",$1;}'
